default_pre_build                                           &&
cd  $SOURCE_DIRECTORY                                       &&
patch  -p1  <  $SCRIPT_DIRECTORY/simpleinit.patch           &&
patch  -p0  <  $SCRIPT_DIRECTORY/simpleinit-1000uid.patch   &&
patch  -p1  <  $SCRIPT_DIRECTORY/simpleinit-msb-crypt.diff  &&
patch -p0 < $SPELL_DIRECTORY/simpleinit.nonls.diff          &&
patch -p0 < $SPELL_DIRECTORY/shutdown.nonls.diff            &&
patch -p0 < $SPELL_DIRECTORY/simpleinit-output-on-shutdown.patch  &&
#the patch fails, if it's still needed it should be regenerated.
#patch -p1 < $SPELL_DIRECTORY/simpleinit-selinux.patch &&
if [[ $SIMPLEINIT_STATIC == y ]]; then
sedit 's#shutdown: shutdown.o $(LIB)/my_reboot.o $(LIB)/xstrncpy.o#shutdown: shutdown.o $(LIB)/my_reboot.o $(LIB)/xstrncpy.o\n\t$(CC) $(LDFLAGS) -o $@ $^#' login-utils/Makefile  &&
sedit 's:$(CC) $(LDFLAGS):$(CC) -static $(LDFLAGS):g' login-utils/Makefile
fi
