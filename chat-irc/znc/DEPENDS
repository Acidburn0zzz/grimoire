. "$GRIMOIRE/FUNCTIONS" &&

depends -sub CXX gcc &&

message "NOTE: ZNC needs swig enabled for modperl/modpython support" &&

optional_depends perl \
                 "--enable-perl" \
                 "--disable-perl" \
                 "to use perl" &&

if is_depends_enabled $SPELL perl; then
  depends -sub PERL swig '--enable-swig'
fi &&

if spell_ok python3; then
  local PYTHON3_BRANCH=$(installed_version python3 | cut -d. -f1,2)
else
  local PYTHON3_BRANCH=$(codex_set_current_spell_quick python3; echo $VERSION | cut -d. -f1,2)
fi &&

optional_depends python3 \
                 "--enable-python=python-$PYTHON3_BRANCH" \
                 "--disable-python" \
                 "to use Python" &&

if is_depends_enabled $SPELL python3; then
  depends -sub PYTHON3 swig '--enable-swig' &&

  if spell_ok swig && is_version_less $(installed_version swig) 2.0.4; then
    force_depends swig
  fi
fi &&

optional_depends tcl \
                 "--enable-tcl" \
                 "--disable-tcl" \
                 "to use TCL" &&

if is_depends_enabled $SPELL tcl && list_find "--disable-extra" "$ZNC_OPTS"; then
  message "Requested TCL support, forcing build of extra modules" &&
  ZNC_OPTS="--enable-extra $ZNC_OPTS"
fi &&

optional_depends cyrus-sasl \
                 "--enable-sasl" \
                 "--disable-sasl" \
                 "for SASL support" &&

optional_depends c-ares \
                 "--enable-c-ares" \
                 "--disable-c-ares" \
                 "for c-ares usage" &&

optional_depends openssl \
                 "--enable-openssl" \
                 "--disable-openssl" \
                 "to use OpenSSL"
