#-------------------------------------------------------------------------
## Helper to install extra directories and files.
#-------------------------------------------------------------------------
function emacs_lisp_install() {
  cp -vr "${@/#/$SOURCE_DIRECTORY/}" \
    "$INSTALL_ROOT/usr/share/emacs/site-lisp/$SPELL/"
}

#-------------------------------------------------------------------------
## Section-default build script.
#-------------------------------------------------------------------------
function default_build_emacs_lisp() {
  [ $# = 0 ] && set -- "$SOURCE_DIRECTORY"
  shopt -s nullglob

  local texi_files

  while [ $# -gt 0 ]; do
    emacs -Q -L "$1" -batch -f batch-byte-compile "$1"/*.el &&
    texi_files=("$1"/*.texi)
    if [ ${#texi_files[@]} -gt 0 ]
    then
      makeinfo "${texi_files[@]}" &&
      gzip -9 "$1"/*.info
    fi
    shift
  done
}

#-------------------------------------------------------------------------
## Section-default install script.
#-------------------------------------------------------------------------
function default_install_emacs_lisp() {
  [ $# = 0 ] && set -- "$SOURCE_DIRECTORY"
  shopt -s nullglob

  local dir="$INSTALL_ROOT/usr/share/emacs/site-lisp/$SPELL"
  local info_dir="$INSTALL_ROOT/usr/share/info"

  local info_files

  while [ $# -gt 0 ]; do
    install -d -m755 "$dir" &&
    install -m644 "$1"/*.el "$1"/*.elc "$dir" &&
    info_files=("$1"/*.info.gz)
    if [ ${#info_files[@]} -gt 0 ]
    then
      install -m644 "${info_files[@]}" "$info_dir" &&
      install-info --info-dir="$info_dir" "${info_files[@]/#*\//$info_dir/}"
    fi
    shift
  done
}

function default_build() {
   default_build_emacs_lisp
}

function default_install() {
   default_install_emacs_lisp
}
