default_pre_build &&
cd $SOURCE_DIRECTORY &&

sedit "s:5.0:5.1:g;s:500:501:g;s:/usr/local:$INSTALL_ROOT/usr:g" config &&
sedit "s#^LUA_LIBDIR=.*#LUA_LIBDIR=$(pkg-config --variable INSTALL_CMOD lua)#" config &&
sedit "s#^LUA_DIR=.*#LUA_DIR=$(pkg-config --variable INSTALL_LMOD lua)#" config &&
sedit "s#^LUA_INC=.*#LUA_INC=$(pkg-config --variable INSTALL_INC lua)#" config &&
sedit "s#^EXPAT_INC=.*#EXPAT_INC=/usr/include#" config &&
sedit "s#^LUA_VERSION_NUM=.*#LUA_VERSION_NUM=501#" config &&
if [[ "${SMGL_COMPAT_ARCHS[1]}" = "x86_64" ]]; then
  sedit "s/-ansi/-fPIC -ansi/" config
fi &&
patch -p0 < "${SCRIPT_DIRECTORY}/makefile.patch"
