lock_resources "libgrimoire" "install"  &&
if [ -z $INSTALL_ROOT ]; then
  mkdir -p $SOURCE_DIRECTORY.bld/old.libs  &&
  (cp -Pp /lib/* $SOURCE_DIRECTORY.bld/old.libs/ || true ) &&
  ldconfig $SOURCE_DIRECTORY.bld/old.libs  &&
  local LD  &&
  if [[ ${SMGL_COMPAT_ARCHS[1]} == x86_64 ]] && test  -f /lib/ld-linux-x86-64.so.2; then
    LD=$(readlink /lib/ld-linux-x86-64.so.2)  &&
    ln -sf $SOURCE_DIRECTORY.bld/old.libs/$LD /lib/ld-linux-x86-64.so.2
  elif [[ ${SMGL_COMPAT_ARCHS[1]} == x86_64 ]] && test  -f /lib64/ld-linux-x86-64.so.2; then
    LD=$(readlink /lib64/ld-linux-x86-64.so.2)  &&
    ln -sf $SOURCE_DIRECTORY.bld/old.libs/$LD /lib64/ld-linux-x86-64.so.2
  else
    LD=$(readlink /lib/ld-linux.so.2)  &&
    ln -sf $SOURCE_DIRECTORY.bld/old.libs/$LD /lib/ld-linux.so.2
  fi
fi  &&

if  spell_ok  glibc;  then
  dispel  --notriggers  --nosustain  glibc
else
# fix cases where previous install failed, but files exist
  OLDGLIB=`ls -l /lib/libc.so.6|cut -d\  -f11 |sed 's/^libc-//;s/.so//'` &&
  rm -f /lib/*${OLDGLIB}.so &&
  rm -f /lib/lib{c,crypt,dl,m,nsl,nss*,pthread,resolv,util}.so.? &&
  rm -rf /usr/share/zoneinfo
fi
