#
## Default configuration for APR spells
#
function default_configure_apr ()
{
  config_query APR_LATEST 'Would you like to use the latest source code (may not build)?' n &&

  config_query_option APR_ATOMICS 'Enable non-portable atomics (i486+)?' y \
    '--enable-nonportable-atomics' \
    '--disable-nonportable-atomics'
}

#
## Build for APR spells
#
function build_apr()
{
  OPTS="$OPTS $APR_ATOMICS" &&

  ./configure                                   \
    --host=$HOST                                \
    --build=$BUILD                              \
    --prefix=$INSTALL_ROOT/usr                  \
    --includedir=$INSTALL_ROOT/usr/include/apr  \
    --sysconfdir=$INSTALL_ROOT/etc              \
    --localstatedir=$INSTALL_ROOT/var           \
    --enable-layout=GNU                         \
    --enable-threads                            \
    $OPTS                                       &&

  make
}

#
## Gets the source hash from a sha* file in the spell directory
## This assumes SOURCEN has been specified before this is called
#
function get_source_hash()
{
  local SNUM=$1
  # fail if it hasn't been rcreated yet
  [[ -z $(eval '$SOURCE'$SNUM) ]] && return 1
  for i in sha512 sha256 sha1 md5
  do
    local source=$(eval '$SOURCE'$SNUM)
    local sum=$(awk '$2 ~ /'$source'/ { print $1 }' $SPELL_DIRECTORY/${i}sums)
    [[ $sum ]] &&
    echo $sum &&
    return 0
  done
  return 1
}
