--- userspace/libsinsp/json_query.h.orig	2016-07-14 04:11:40.000000000 -0400
+++ userspace/libsinsp/json_query.h	2016-07-18 11:55:48.890138942 -0400
@@ -24,10 +24,12 @@
 // jq is not C++-friendly
 extern "C"
 {
-	#include "compile.h"
 	#include "jv.h"
 	#include "jq.h"
 	//+++ jq C++ compile fixes
+	#ifdef USE_BUNDLED_JQ
+	#include "compile.h"
+	#include "util.h"
 	#ifndef NDEBUG
 	#	define NDEBUG
 	#	include "jv_alloc.h"
@@ -35,6 +37,8 @@
 	#else
 	#	include "jv_alloc.h"
 	#endif // NDEBUG
+	#endif // 
+	//--- jq C++ compile fixes
 	#ifndef HAVE_MKSTEMP
 	#	include <stdlib.h>
 	#	include <fcntl.h>
@@ -58,11 +62,10 @@
 		}
 	#	define HAVE_MKSTEMP
 	#endif // HAVE_MKSTEMP
-	//--- jq C++ compile fix
-	#include "util.h"
 }
 
 #include <string>
+#include <stdexcept>
 
 class json_query
 {
