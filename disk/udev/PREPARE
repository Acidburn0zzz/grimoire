# Source grimoire FUNCTIONS to have get_kernel_version
. $SCRIPT_DIRECTORY/../../FUNCTIONS

# testing if the install_config_file function is available
# we don't want to spend time building udev if we can't install it properly

if  ! grep -q install_config_file /var/lib/sorcery/modules/libapi ;  then
    message  "${PROBLEM_COLOR}You don't have the latest stable Sorcery. Run
              \`sorcery update\`${DEFAULT_COLOR}"  &&
    return  1
fi                                                                                              &&

KERNEL_VERSION=$(get_kernel_version)  &&
PATCHLEVEL=`echo $KERNEL_VERSION | cut -d. -f2`  &&
SUBLEVEL=`echo $KERNEL_VERSION | cut -d. -f3`  &&
tmp=`echo $KERNEL_VERSION | cut -d. -f3 | sed 's/^[0-9]*//g'`  &&
SUBLEVEL=${SUBLEVEL/$tmp/}  &&

# kernel < 2.6.15-rc1 can't use udev > 0.93 tarballs because udevsend has been removed
if [ $SUBLEVEL -ge 15 -a $PATCHLEVEL -ge 6 ]; then
  RECENT_KERNEL="y"
else
  RECENT_KERNEL="n"  &&
  message  "You have a kernel < 2.6.15, it is too old for latest udev."  &&
  message  "Switching to 092..."
fi  &&
persistent_add RECENT_KERNEL
