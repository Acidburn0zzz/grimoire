--- src/knockd.c.orig	2005-06-27 09:11:34.000000000 +0400
+++ src/knockd.c	2011-05-03 23:41:20.133684648 +0400
@@ -46,6 +46,7 @@
 #include <syslog.h>
 #include <pcap.h>
 #include <errno.h>
+#include <limits.h>
 #include "list.h"
 
 static char version[] = "0.5";
@@ -193,7 +194,7 @@
 		}
 	}
 
-	cap = pcap_open_live(o_int, 65535, 0, 0, pcapErr);
+	cap = pcap_open_live(o_int, 65535, 0, 1000, pcapErr);
 	if(strlen(pcapErr)) {
 		fprintf(stderr, "could not open %s: %s\n", o_int, pcapErr);
 	}
@@ -371,7 +372,18 @@
 	}
 	list_free(doors);
 
+	if(logfd) {
+		fclose(logfd);
+		logfd = NULL;
+	}
 	parseconfig(o_cfg);
+	if(strlen(o_logfile)) {
+		/* open the log file */
+		logfd = fopen(o_logfile, "a");
+		if(logfd == NULL) {
+			perror("warning: cannot open logfile");
+		}
+	}
 	return;
 }
 
--- src/knock.c.orig	2005-06-27 09:11:34.000000000 +0400
+++ src/knock.c	2011-05-03 23:35:39.297684650 +0400
@@ -128,6 +128,7 @@
 			connect(sd, (struct sockaddr*)&addr, sizeof(struct sockaddr));
 		}
 		close(sd);
+		usleep(1);
 	}
 
 	return(0);
