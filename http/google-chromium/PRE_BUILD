default_pre_build &&
cd $SOURCE_DIRECTORY &&

#
# Drop SSE2
# See http://code.google.com/p/chromium/wiki/LinuxPackaging#SSE_flags
#
patch $SOURCE_DIRECTORY/build/common.gypi $SCRIPT_DIRECTORY/chromium-drop_sse2.patch &&

# Disable compiling with -Werror
sed -i 's:-Werror::' build/common.gypi &&

# Use system zlib
sed -i -e '/^#include "mozzconf.h"$/d' third_party/zlib/zconf.h &&

# Use custom CFLAGS/LDFLAGS
mkdir -p $SOURCE_DIRECTORY/.gyp &&
cat << EOF > $SOURCE_DIRECTORY/.gyp/include.gypi
{
	'target_defaults': {
		'cflags': [ '${CFLAGS// /','}' ],
		'ldflags': [ '${LDFLAGS// /','}' ],
	},
}
EOF
