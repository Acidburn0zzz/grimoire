mk_source_dir  $SOURCE_DIRECTORY  &&
cd  $SOURCE_DIRECTORY             &&
unpack_file  ''                   &&
cd  mozilla*                       &&

#Fedora  patch to remove glyph in title bar
# http://osdir.com/ml/scm-fedora-commits/2011-06/msg10320.html
patch -p0 < $SPELL_DIRECTORY/glyph.patch &&

# Archlinux patch to drop release point from install path
# http://projects.archlinux.org/svntogit/packages.git/plain/trunk/firefox-install-dir.patch?h=packages/firefox
patch -p1 < $SPELL_DIRECTORY/install_dir.patch &&

# fixes https://bugzilla.mozilla.org/show_bug.cgi?id=752895
patch -p1 < $SPELL_DIRECTORY/installer.patch &&

cp -v $SPELL_DIRECTORY/mozconfig .mozconfig &&

if [[ "$FIREFOX_SAFE" == "y" ]]; then
   sed -i '27iac_add_options --enable-safe-browsing' .mozconfig
else
   sed -i '27iac_add_options --disable-safe-browsing' .mozconfig
fi &&

if is_depends_enabled $SPELL wireless_tools; then
   sed -i '27iac_add_options --enable-necko-wifi' .mozconfig
else
   sed -i '27iac_add_options --disable-necko-wifi' .mozconfig
fi &&

if is_depends_enabled $SPELL yasm; then
   sed -i '27iac_add_options --enable-webm' .mozconfig
else
   sed -i '27iac_add_options --disable-webm' .mozconfig
fi &&

if ! is_depends_enabled $SPELL alsa-lib; then
   sed -i '27iac_add_options --disable-ogg' .mozconfig &&
   sed -i '27iac_add_options --disable-wave' .mozconfig
fi &&

if [[ "$FIREFOX_STRIP" == "y" ]]; then
   sed -i '27iac_add_options --enable-strip' .mozconfig
fi &&


if [[ $FIREFOX_OFFICIAL == y ]]; then
  sed -i '27iac_add_options --enable-official-branding' .mozconfig || return 1
fi
