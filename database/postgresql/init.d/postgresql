#!/bin/bash

PROGRAM=/usr/bin/postmaster
RUNLEVEL=3
NEEDS="+remote_fs"

. /etc/init.d/smgl_init
. /etc/sysconfig/postgresql

start()
{
  echo "Starting postmaster..."
  cd "$DBPATH" &&
  if  [[ ! -z  "$PORT"  ]];  then
    PGPORT="-p $PORT"
  fi           &&
  if  [[ ! "$LOGFILE" = 'syslog' ]];  then
    PGLOG="-l $LOGFILE"
  fi           &&
  su -s /bin/sh -m -c "pg_ctl start -D '$DBPATH' $PGLOG -p /usr/bin/postgres -o '$PGPORT'" -l "$USER"
  evaluate_retval
}

stop()
{
  echo "Stopping postmaster..."
  cd "$DBPATH" &&
  su -s /bin/sh -c "pg_ctl stop -D '$DBPATH' -m fast" -l "$USER"
  evaluate_retval
}

restart()
{
  echo "Restarting postmaster..."
  stop
  start
#  cd "$DBPATH" &&
#  if  [[ "$LOGFILE" = 'syslog' ]];  then
#    su -l "$USER" -s /bin/sh -c "pg_ctl restart -D '$DBPATH'"
#  else
#    su -l "$USER" -s /bin/sh -c "pg_ctl restart -D '$DBPATH' -l '$LOGFILE'"
#  fi
}
