. $GRIMOIRE/FUNCTIONS

case "$XORG_SHA1" in
  nettle)
    depends nettle '--with-sha1=libnettle'
  ;;
  libgcrypt)
    depends libgcrypt '--with-sha1=libgcrypt'
  ;;
  openssl)
    depends SSL '--with-sha1=libcrypto'
  ;;
esac &&

depends xcb-util &&
depends xcb-util-image &&
depends xcb-util-wm &&
depends xcb-util-keysyms &&
depends xcb-util-renderutil &&
depends presentproto &&

#
## Check this every release as X.org likes to change things on us...
#
##Check this on updates
depends  libxv "--enable-xv"             &&

optional_depends  libxinerama             \
                    "--enable-xinerama"            \
                    "--disable-xinerama"           \
                    "Multi screen support" &&
##
optional_depends  libselinux                       \
                  ""              \
                  ""             \
                  "Enable SELinux support"         &&
optional_depends  dri2proto                        \
                  "--enable-dri2"                  \
                  "--disable-dri2"                 \
                  "Enable DRI2 extension"          &&
optional_depends  dri3proto                        \
                  "--enable-dri3"                  \
                  "--disable-dri3"                 \
                  "Enable DRI3 extension"          &&
optional_depends  libxscrnsaver                    \
                  "--enable-screensaver"           \
                  "--disable-screensaver"          \
                  "Build ScreenSaver extension"    &&
optional_depends  libxvmc                          \
                  "--enable-xvmc"                  \
                  "--disable-xvmc"                 \
                  "Enable support for XvMC"        &&

#
# May only select one:
# configure: error: Hotplugging through both libudev and dbus/hal not allowed
#
# NOTE: as hal depends on dbus, we can safely enable/disable dbus's configure
# options with hal
#
# hal is preferred by upstream:
#  --enable-config-udev    Build udev support (default: auto)
#  --enable-config-dbus    Build D-BUS API support (default: no)
#  --disable-config-hal    Build HAL support (default: auto)
#

message "You can either use hal+dbus OR udev for hotplugging" &&
message "but NOT both" &&
optional_depends  hal \
         "--enable-config-hal --enable-config-dbus --disable-config-udev" \
         "--disable-config-hal --disable-config-dbus" \
         "Enable HAL support" &&

if ! is_depends_enabled $SPELL hal; then
  optional_depends DEVICE-MANAGER \
    "--enable-config-udev --disable-config-dbus --disable-config-hal" \
    "--disable-config-udev" \
    "enable udev kernel config support"
fi &&

optional_depends  dmxproto                           \
                  "--enable-dmx"                   \
                  "--disable-dmx"                  \
                  "Build DMX server"               &&
if is_depends_enabled $SPELL dmxproto;then
  depends -sub XAW7 libxaw &&
  depends libdmx &&
  depends libxt  &&
  depends libxpm &&
  depends libxmu
fi &&


if  list_find  "$XORG_SERVER_OPTS"  "--enable-glamor";  then
  depends libepoxy
fi &&

optional_depends nettle  '--with-sha1=libnettle' '' 'SHA1 crypto support' &&
optional_depends wayland '--enable-xwayland'  \
                         '--disable-xwayland' \
                         'build Xwayland DDX' &&

optional_depends libunwind '' '' 'debugging support' &&

depends  freetype2                                 &&
depends  libxfontcache                             &&
depends  libxxf86dga "--enable-dga"                &&
depends  libxcomposite  "--enable-composite"       &&
depends  libxxf86vm "--enable-xf86vidmode"         &&
depends  libxi                                     &&
depends  util-macros                               &&
depends  xinit                                     &&
depends  xhost                                     &&
depends  xauth                                     &&
depends  bigreqsproto                              &&
depends  pixman                                    &&
depends  compositeproto                            &&
depends  damageproto                               &&
depends  evieext                                   &&
depends  fixesproto                                &&
depends  fontcacheproto                            &&
depends  fontsproto                                &&
depends  glproto                                   &&
depends  inputproto                                &&
depends  kbproto                                   &&
depends  randrproto                                &&
depends  libxshmfence  &&

if list_find "$XORG_SERVER_OPTS" "--enable-record"; then
  depends recordproto
fi &&

depends  renderproto                               &&
depends  resourceproto                             &&
depends  scrnsaverproto                            &&
depends  videoproto                                &&
depends  xcmiscproto                               &&
depends  xextproto                                 &&
depends  xf86bigfontproto                          &&
depends  xf86dgaproto                              &&
depends  xf86driproto                              &&
depends  xf86vidmodeproto                          &&
depends  xproto                                    &&
depends  xproxymanagementprotocol                  &&
depends  libxkbui                                  &&
depends  -sub 'FC' libxfont                        &&
depends  xtrans                                    &&
depends  libxau                                    &&
depends  libxkbfile                                &&
depends  libxdmcp                                  &&
depends  libdrm                                    &&
depends  libxres                                   &&
depends  bison                                     &&
depends  flex                                      &&
depends  pkgconfig                                 &&
depends  libtool                                   &&
depends  AWK                                       &&
depends  mesalib                                   &&
depends  smgl-gl_select                            &&
depends  rgb                                       &&
depends  font-cursor-misc                          &&
depends  font-misc-misc                            &&
depends  font-alias                                &&
depends  libpciaccess                              &&
depends  libxtst                                   &&

if list_find "$XORG_SERVER_FONT_100DPI" "all"
then
depends font-bh-100dpi                             &&
depends font-adobe-100dpi                          &&
depends font-bitstream-100dpi                      &&
depends font-adobe-utopia-100dpi                   &&
depends font-bh-lucidatypewriter-100dpi
elif list_find "$XORG_SERVER_FONT_100DPI" "none"
then
true
else
for font100dpi in $XORG_SERVER_FONT_100DPI
do
depends $font100dpi
done
fi                                                 &&

if list_find "$XORG_SERVER_FONT_75DPI" "all"
then
depends font-bh-75dpi                              &&
depends font-adobe-75dpi                           &&
depends font-bitstream-75dpi                       &&
depends font-adobe-utopia-75dpi                    &&
depends font-bh-lucidatypewriter-75dpi
elif list_find "$XORG_SERVER_FONT_75DPI" "none"
then
true
else
for font75dpi in $XORG_SERVER_FONT_75DPI
do
depends $font75dpi
done
fi                                                 &&

if list_find "$XORG_SERVER_FONT_SPEEDO" "all"
then
depends font-bitstream-speedo
elif list_find "$XORG_SERVER_FONT_SPEEDO" "none"
then
true
else
for speedo in $XORG_SERVER_FONT_SPEEDO
do
depends $speedo
done
fi                                                 &&

if list_find "$XORG_SERVER_FONT_TYPE1" "all"
then
depends font-bh-type1                              &&
depends font-ibm-type1                             &&
depends font-xfree86-type1                         &&
depends font-bitstream-type1                       &&
depends font-adobe-utopia-type1
elif list_find "$XORG_SERVER_FONT_TYPE1" "none"
then
true
else
for type1 in $XORG_SERVER_FONT_TYPE1
do
depends $type1
done
fi                                                 &&

if list_find "$XORG_SERVER_FONT_TTFOTF" "all"
then
depends font-bh-ttf                                &&
depends font-misc-meltho                           &&
depends font-misc-ethiopic
elif list_find "$XORG_SERVER_FONT_TTFOTF" "none"
then
true
else
for ttfotf in $XORG_SERVER_FONT_TTFOTF
do
depends $ttfotf
done
fi                                                 &&

if list_find "$XORG_SERVER_FONT_MISC" "all"
then
depends font-dec-misc                              &&
depends font-sun-misc                              &&
depends font-jis-misc                              &&
depends font-mutt-misc                             &&
depends font-sony-misc                             &&
depends font-isas-misc                             &&
depends font-micro-misc                            &&
depends font-arabic-misc                           &&
depends font-daewoo-misc                           &&
depends font-misc-cyrillic                         &&
depends font-cronyx-cyrillic                       &&
depends font-schumacher-misc                       &&
depends font-screen-cyrillic                       &&
depends font-winitzki-cyrillic
elif list_find "$XORG_SERVER_FONT_MISC" "none"
then
true
else
for misc in $XORG_SERVER_FONT_MISC
do
depends $misc
done
fi

message 'choose an input driver' &&
message 'if these drivers are not suitable, choose from the xorg-drivers section' &&

suggest_depends xf86-input-evdev '' ''  'modern input drivers' &&
suggest_depends xf86-input-synaptics '' '' 'modern input drivers' &&
suggest_depends xf86-input-libinput '' '' 'modern input drivers' &&
suggest_depends xf86-video-ati   '' '' 'modern ATI drivers' &&
suggest_depends xf86-video-intel '' '' 'modern Intel drivers' &&
suggest_depends xf86-video-nv    '' '' 'modern NVidia drivers'
