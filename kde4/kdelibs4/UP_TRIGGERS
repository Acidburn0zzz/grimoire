#
# Nepomuk was installed by kdebase-workspace4 in KDE 4.3, but now it is
# installed by kdelibs4 in KDE 4.4.
# Rebuild kdebase-workspace4 from KDE 4.3 after updating kdelibs4 to KDE 4.4
# Bug #15573
#
if $(gaze from /opt/kde4/include/nepomuk/resource.h|grep -q kdebase-workspace4-4.3) &&
   [[ "$(installed_version kdelibs4|cut -d. -f1,2)" -ne "$(installed_version kdebase-workspace4|cut -d. -f1,2)" ]]
then
  up_trigger kdebase-workspace4 cast_self
fi


#
# We moved kde from /opt/kde4 to /usr. now we must rebuild all spells 
# that depend on kde being in /opt/kde4
#
if $(gaze from /opt/kde4 |grep -q kdelibs); then
  LL=`grep :kde.*4.*:on: /var/state/sorcery/depends|cut -d:  -f1|sort|uniq`
  for spell in $LL;do
    up_trigger $spell cast_self
  done
fi
