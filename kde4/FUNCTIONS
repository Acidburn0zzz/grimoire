default_build() {
QTDIR=$INSTALL_ROOT/usr                         &&
PATH=$QTDIR/bin/qt4:$PATH                       &&

persistent_add KDE4DIR                          &&
KDE4DIR=$INSTALL_ROOT/opt                       &&

PATH=$KDE4DIR/bin:$PATH                         &&
LD_LIBRARY_PATH=$KDE4DIR/lib:$LD_LIBRARY_PATH   &&
QT_PLUGIN_PATH=$KDE4DIR/lib/kde4/plugins        &&

cd $SOURCE_DIRECTORY                            &&
mkdir -p build                                  &&
cd build                                        &&
cmake -DCMAKE_INSTALL_PREFIX=$KDE4DIR           \
      -DCMAKE_BUILD_TYPE=$KDE_DEBUG_OPTION      \
      ../                                       &&
make
}

# kde4 also needs a special default_install,
# to maintain some environment variables
default_install() {
QTDIR=$INSTALL_ROOT/usr                         &&
PATH=$QTDIR/bin/qt4:$PATH                       &&

KDE4DIR=$INSTALL_ROOT/opt                       &&

PATH=$KDE4DIR/bin:$PATH                         &&
LD_LIBRARY_PATH=$KDE4DIR/lib:$LD_LIBRARY_PATH   &&
QT_PLUGIN_PATH=$KDE4DIR/lib/kde4/plugins        &&

cd $SOURCE_DIRECTORY/build                      &&
make install
}


# we need a default_final, default_post_remove
# so that the mime and desktop databases get updated

update_databases() {
update-mime-database /opt/share/mime/
update-desktop-database /opt/share/desktop-directories
}

default_final() {
update_databases
}


default_post_remove() {
update_databases
}
