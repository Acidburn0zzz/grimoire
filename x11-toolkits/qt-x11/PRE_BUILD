default_pre_build     &&
cd $SOURCE_DIRECTORY  &&
# apply patches
patch -p0 < $SPELL_DIRECTORY/Qt-3.3.8-UTF-8-fix.diff &&
patch -p4 < $SPELL_DIRECTORY/170529.diff &&
patch -p0 < $SPELL_DIRECTORY/175791_3.diff &&
patch -p1 < $SPELL_DIRECTORY/Qt-3.3.8_png-1.4_fix.patch &&
# fix detecction of firebird
sedit "s/-lgds//" configure  &&
sedit "/gds/D;/\t}/D" plugins/src/sqldrivers/ibase/ibase.pro &&

# speed up up build process by removing unnecessary examples
rm -r examples
rm -r extensions/nsplugin/examples
#rm -r extensions/xt/examples
rm -r tools/designer/examples
#rm -r tools/designer/tutorials
#rm -r tools/linguist/tutorial
#rm -r tools
rm -r tutorial

# add better optimisation flags
sedit "s#-O2#$CFLAGS#" mkspecs/linux-g++/qmake.conf &&
sedit "s#-O2#$CFLAGS#" mkspecs/linux-cxx/qmake.conf



#  if  spell_ok  postgresql;  then
#    cd  $SOURCE_DIRECTORY  &&
#   tar  -zxpf  /var/spool/sorcery/postgresql-`installed_version postgresql`.tar.gz  &&
#    cd  postgresql-`installed_version postgresql`  &&
#    ./configure  &&
#    cd  $SOURCE_DIRECTORY
#  fi
