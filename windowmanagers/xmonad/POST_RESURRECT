# We need to restore package.conf and package.conf.old after resurrection.
# Also we need to register package with ghc-pkg.

message "${MESSAGE_COLOR}Restoring package.conf and package.conf.old...${DEFAULT_COLOR}"
GHC_VERSION=$(ghc --version | tr -d ' ,[:alpha:]')
GHC_DIR=${INSTALL_ROOT}/usr/lib/ghc-${GHC_VERSION}
mv -v ${GHC_DIR}/package.conf.bak ${GHC_DIR}/package.conf
if [ -f ${GHC_DIR}/package.conf.old.bak ] ; then
  mv -v ${GHC_DIR}/package.conf.old.bak ${GHC_DIR}/package.conf.old
fi

message "${MESSAGE_COLOR}Registering package with ghc-pkg...${DEFAULT_COLOR}"
CABAL_FILE=${INSTALL_ROOT}/usr/share/xmonad/xmonad.cabal
ghc-pkg register --force-files $CABAL_FILE
message "${MESSAGE_COLOR}Exposing package with ghc-pkg...${DEFAULT_COLOR}"
ghc-pkg expose xmonad
