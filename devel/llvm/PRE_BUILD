default_pre_build &&
if [[ "$LLVM_WITH_CLANG" == y ]]; then
  cd ${SOURCE_DIRECTORY}/tools &&
  unpack_file 3 &&
  mv clang-${VERSION} clang &&
  sed -e 's:PIC :pic :g' \
      -e 's: PIC: pic:g' \
      -e 's:(PIC):(pic):' \
      -i clang/lib/Driver/Tools.cpp &&
  cd ${SOURCE_DIRECTORY}
fi &&
# small cmake related fix for libffi
cd ${SOURCE_DIRECTORY} &&
if spell_ok libffi;then
  FFI=`pkg-config --cflags-only-I libffi` &&
  FFI=${FFI//-I/} &&
  FFI=${FFI//\ */} &&
  sed -i "/FFI_I/s|\"\"|\"$FFI\"|" CMakeLists.txt
fi  &&
if is_depends_enabled $SPELL python3;then
  cd utils/llvm-build/llvmbuild &&
  2to3 --no-diffs -wn .
fi

