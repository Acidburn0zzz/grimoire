list_remove  MESALIB_DRIVERS  nouveau  || true
list_remove  MESALIB_DRIVERS  i915tex  || true
# ordering is important
MESALIB_BUILD=${MESALIB_BUILD/linux-dri/dri}
MESALIB_BUILD=${MESALIB_BUILD/linux-dri-x86-64/dri}
MESALIB_BUILD=${MESALIB_BUILD/linux-dri-x86/dri}
MESALIB_BUILD=${MESALIB_BUILD/linux-dri-ppc/dri}
MESALIB_BUILD=${MESALIB_BUILD/linux-ppc/xlib}
MESALIB_BUILD=${MESALIB_BUILD/linux-x86-64/xlib}
MESALIB_BUILD=${MESALIB_BUILD/linux-x86/xlib}
MESALIB_BUILD=${MESALIB_BUILD/linux-fbdev/xlib}
MESALIB_BUILD=${MESALIB_BUILD/linux-directfb/xlib}
MESALIB_BUILD=${MESALIB_BUILD/linux-glide/xlib}
MESALIB_BUILD=${MESALIB_BUILD/linux-sparc5/xlib}
MESALIB_BUILD=${MESALIB_BUILD/linux-sparc/xlib}
MESALIB_BUILD=${MESALIB_BUILD/linux-ultrasparc/xlib}
MESALIB_BUILD=${MESALIB_BUILD/linux/xlib}

. $GRIMOIRE/config_query_multi.function                                  &&
config_query_list MESALIB_BUILD                                          \
                  "Select build type? (dri required for xorg-server)"    \
                  xlib                                                   \
                  dri                                                    \
                  osmesa                                                 &&
if [[ $MESALIB_BUILD == dri ]]; then
config_query_multi MESALIB_DRIVERS                                       \
                   "What drivers would you like to build?"               \
                   swrast                                                \
                   all                                                   \
                   i810                                                  \
                   i915                                                  \
                   i965                                                  \
                   mach64                                                \
                   mga                                                   \
                   r128                                                  \
                   r200                                                  \
                   r300                                                  \
                   radeon                                                \
                   s3v                                                   \
                   savage                                                \
                   sis                                                   \
                   tdfx                                                  \
                   trident                                               \
                   unichrome                                             \
                   ffb                                                   &&
  if list_find "$MESALIB_DRIVERS" all
  then
  MESALIB_DRIVERS="i810 i915 i965 mach64 mga r128 r200 r300 radeon s3v savage sis tdfx trident unichrome ffb swrast"
  fi
fi                                                                       &&

if [[ $MESALIB_BUILD == xlib ]]; then
config_query_multi MESALIB_DRIVERS                                       \
                   "What drivers would you like to build?"               \
                   swrast
fi
