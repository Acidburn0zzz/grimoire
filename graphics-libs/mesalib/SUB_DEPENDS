case $THIS_SUB_DEPENDS in
  NONSTABLE)
    if [[ "$MESALIB_BRANCH" == "stable" ]]; then
      MESALIB_BRANCH="feature" &&
      persistent_add MESALIB_BRANCH &&
      message "${MESSAGE_COLOR}Non-stable branch of ${SPELL_COLOR}mesalib${DEFAULT_COLOR}" \
              "${MESSAGE_COLOR}requested, upgrading to ${SPELL_COLOR}feature${DEFAULT_COLOR}" \
              "${MESSAGE_COLOR}branch."
    fi
    ;;

  DRI)
    MESALIB_BUILD=dri              &&
    persistent_add  MESALIB_BUILD  &&

    message "${MESSAGE_COLOR}DRI support requested, forcing build type"  \
            "$MESALIB_BUILD for architecture\n${SMGL_COMPAT_ARCHS[1]}."  \
            "$DEFAULT_COLOR"                                             &&
    list_remove  MESALIB_DRIVERS  i915tex  || true

    . $GRIMOIRE/config_query_multi.function                              &&
   if [[ $MESALIB_BUILD == dri ]]; then
      if  [[  "$MESALIB_BRANCH"  ==  "stable"  ]];  then
         AVAILABLE_DRIVERS="i810 i915 i965 mach64 mga r128 r200 r300 r600 radeon s3v savage sis tdfx trident unichrome ffb swrast"
      elif  [[  "$MESALIB_BRANCH"  ==  "feature"  ]];  then
         AVAILABLE_DRIVERS="i810 i915 i965 mach64 mga r128 r200 r300 r600 radeon s3v savage sis tdfx trident unichrome ffb swrast"
      else
         AVAILABLE_DRIVERS="i915 i965 nouveau r200 radeon swrast"
      fi
   config_query_multi MESALIB_DRIVERS                                    \
                      "What drivers would you like to build?"            \
                      $AVAILABLE_DRIVERS                                 &&
     if list_find "$MESALIB_DRIVERS" all
     then
     MESALIB_DRIVERS="$AVAILABLE_DRIVERS"
     fi
   fi                                                                    ;;

  *) echo "Unknown sub_depends $THIS_SUB_DEPENDS!"; return 1 ;;
esac
