# up_trigger everything on updated to 1.5.1 as soname changed from libopenjpeg.so.1 to libopenjpeg.so.5
# .so files now called libopenjp2.so

. "$GRIMOIRE/FUNCTIONS" &&

local OLD_SPELL_VERSION=""
if spell_ok  $SPELL; then
  OLD_SPELL_VERSION="$(installed_version $SPELL)"
  if is_version_less "${OLD_SPELL_VERSION}" "2.1.0"; then

    message "This is a possibly incompatible update of $SPELL..."
    message "Figuring out what spells need to be recast, this may take a while."
    for each in $(show_up_depends $SPELL); do
      if gaze install $each | xargs readelf -d 2> /dev/null |
         grep -q "NEEDED.*libopenjpeg\.so\.?"; then
           up_trigger $each cast_self
      fi
    done
  fi
fi
