default_install  &&

# move old local to new local, can eventually get rid of this
if [ -d "/usr/share/texmf-local" ]; then
  mv ${INSTALL_ROOT}/usr/share/texmf-local ${INSTALL_ROOT}/usr/local/share/texmf
fi &&

# create symlinks to latex, pdflatex, etc
${INSTALL_ROOT}/usr/bin/texlinks -f ${INSTALL_ROOT}/usr/share/texmf/web2c/fmtutil.cnf ${INSTALL_ROOT}/usr/bin &&

ln -svf mf ${INSTALL_ROOT}/usr/bin/mf-nowin &&

# don't create aleph files
sed -i -e '/aleph/d' ${INSTALL_ROOT}/usr/share/texmf/web2c/fmtutil.cnf &&

# update filename db & create all formats
mktexlsr &&
fmtutil-sys --cnffile ${INSTALL_ROOT}/usr/share/texmf/web2c/fmtutil.cnf --fmtdir ${INSTALL_ROOT}/usr/share/texmf/web2c --all &&

# allow fontconfig to see latex fonts 
install -Cv ${SPELL_DIRECTORY}/09-texlive-fonts.conf ${INSTALL_ROOT}/etc/fonts/conf.avail &&
ln -fs ${INSTALL_ROOT}/etc/fonts/conf.avail/09-texlive-fonts.conf ${INSTALL_ROOT}/etc/fonts/conf.d &&
fc-cache -fsv && 

if is_depends_enabled $SPELL lua ; then 
  # update filename db & create formats for context
  mtxrun --generate &&
  # generate fonts for luatex & context
  OSFONTDIR="${INSTALL_ROOT}/usr/share/texmf-dist/fonts/;${INSTALL_ROOT}/usr/share/texmf/fonts/;${INSTALL_ROOT}/usr/local/share/texmf/fonts" mtxrun --script fonts --reload 
fi
