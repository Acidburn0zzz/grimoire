default_pre_build  &&

if [[  "$WINE_DEVEL"  ==  "n"  ]];  then
  patch $SOURCE_DIRECTORY/dlls/gdi32/freetype.c                \
        $SCRIPT_DIRECTORY/freetype2-2.3.8-winebug-17024.patch
fi &&
# This is only needed for a period where we can expect mpg123 1.11.0 being installed.
if test "$WINE_VCS" == y -o "$WINE_DEVEL" == y  &&
   [[ ${SMGL_COMPAT_ARCHS[0]} == 32 ]] && is_depends_enabled $SPELL mpg123 &&
   spell_ok mpg123 && [[ $(installed_version mpg123) == 1.11.0 ]]; then
  cd $SOURCE_DIRECTORY &&
  if [[ "$WINE_DEVEL" == y ]]; then
    patch -Np0 < "$SCRIPT_DIRECTORY/wine-1.1.41-mpg123_64.diff"
  else
    patch -Np1 < "$SCRIPT_DIRECTORY/wine-git-mpg123_64.diff"
  fi &&
  autoreconf -iv
fi &&

if [[ "$WINE_SC2_LOGIN" == "y" ]]; then
  message "${MESSAGE_COLOR}Applying StarCraft II login bug patch...${DEFAULT_COLOR}" &&
  cd $SOURCE_DIRECTORY &&
  patch -p1 < $SPELL_DIRECTORY/sc2-login.diff
fi
