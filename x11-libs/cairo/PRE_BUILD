default_pre_build &&
cd ${SOURCE_DIRECTORY} &&
    
if [[ "$CAIRO_BRANCH" == "scm" ]]; then
    CAIRO_AUTOGEN=y
else
    # http://bugs.gentoo.org/show_bug.cgi?id=336696
    patch -p1 -d "$SOURCE_DIRECTORY" < "$SPELL_DIRECTORY/cairo-1.10.0-buggy_gradients.patch" &&
    # http://sourceforge.net/p/mingw-w64/bugs/396/
    patch -p1 < "$SPELL_DIRECTORY/cairo-broken-lto-build.patch"
fi &&

if list_find "${CAIRO_OPTS}" "--disable-lto"; then
    # https://bugs.freedesktop.org/show_bug.cgi?id=60852 
    patch -p1 < "$SPELL_DIRECTORY/cairo-1.12.16-lto-optional.patch" &&
    CAIRO_AUTOGEN=y
fi &&

if [[ "$CAIRO_AUTOGEN" == "y" ]]; then
    NOCONFIGURE=1 ./autogen.sh
fi
