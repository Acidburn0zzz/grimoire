--- murmur/murmur.orig	2008-12-15 14:51:42.000000000 +0300
+++ murmur/murmur	2011-02-08 02:54:47.000000000 +0300
@@ -2418,7 +2418,16 @@
 		
 		self.Encoding_List = gtk.ListStore(gobject.TYPE_STRING)
 		self.Encoding = gtk.ComboBox()
+
+		if self.frame.Networking.config.has_key("encoding.users") and self.user in self.frame.Networking.config["encoding.users"]:
+			active = Settings.encodings.index(self.frame.Networking.config["encoding.users"][self.user])
+		else:
+			active = Settings.encodings.index(self.frame.Networking.config["encoding"]["network"].upper())
+
+		self.Encoding.set_active(active)
 		self.Encoding.show()
+		for encoding in Settings.encodings:
+			self.Encoding_List.append([encoding])
 		self.Encoding.connect("changed", self.OnEncodingChanged)
 	
 		self.Encoding.set_model(self.Encoding_List)
@@ -2566,8 +2575,18 @@
 				self.frame.Config["logging"]["private"].remove(self.user)
 
 	def OnEncodingChanged(self, widget):
-		pass
-	
+		if not self.frame.Networking.config.has_key("encoding.users"):
+			return
+
+		active = self.Encoding.get_active_text()
+		if active == self.frame.Networking.config["encoding"]["network"].upper():
+			# removing dulications on network level
+			if self.user in self.frame.Networking.config["encoding.users"]:
+				self.frame.Networking.ConfigRemove("encoding.users", self.user)
+		else:
+			if self.user not in self.frame.Networking.config["encoding.users"] or active != self.frame.Networking.config["encoding.users"].get(self.user):
+				self.frame.Networking.ConfigSet("encoding.users", self.user, active)
+
 	def ShowMessage(self, direction, text):
 		if self.user == self.frame.username:
 			tag = self.tag_local
--- murmur/pymurmur/settings.py.orig	2008-09-22 12:49:33.000000000 +0400
+++ murmur/pymurmur/settings.py	2011-02-07 23:51:03.000000000 +0300
@@ -127,6 +128,8 @@
         self.quit()
 	
 class Settings( gtk.Dialog):
+	encodings = ["UTF-8", "UTF-7", "UTF-16", "UTF-32", "KOI8-R", "ISO8859-1", "ISO8859-2", "ISO8859-3", "ISO8859-4", "ISO8859-5", "ISO8859-6", "ISO8859-7", "ISO8859-8", "ISO8859-9", "ISO8859-10", "ISO8859-11", "ISO8859-13", "ISO8859-14", "ISO8859-15", "ISO8859-16", "CP1250", "CP1251", "CP1252", "CP1253", "CP1254", "CP1255", "CP1256", "CP1257", "CP1258", "CP874"]
+
 	def __init__(self, xapp, message="", modal= True):
 		gtk.Dialog.__init__(self)
 		self.app=xapp
@@ -3267,8 +3252,6 @@
 			self.Configfile.set_text(text)
 	
 	def dialogs(self):
-		self.encodings= ["UTF-8", "UTF-7", "UTF-16", "UTF-32", "KOI8-R", "ISO8859-1", "ISO8859-2", "ISO8859-3", "ISO8859-4", "ISO8859-5", "ISO8859-6", "ISO8859-7", "ISO8859-8", "ISO8859-9", "ISO8859-10", "ISO8859-11", "ISO8859-13", "ISO8859-14", "ISO8859-15", "ISO8859-16", "CP1250", "CP1251", "CP1252", "CP1253", "CP1254", "CP1255", "CP1256", "CP1257", "CP1258", "CP874"]
-		
 		self.MainNotebook = gtk.Notebook()
 		self.MainNotebook.set_tab_pos(gtk.POS_TOP)
 		self.MainNotebook.set_scrollable(False)
